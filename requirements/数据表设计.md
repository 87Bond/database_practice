## **① 数据表设计（总览）**

| 表名                  | 核心字段                                                     | 主键/外键                                                    | 设计说明与约束                                               |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **UserDirectory**     | user_id (PK), create_time, is_active, phone, password, user_name | 主键: user_id                                                | 统一用户基表；患者/医生/科室管理员/系统用户共用；is_active 控制登录可用性 |
| **Patient**           | user_id (PK, FK), gender, age, id_card, money                | 主键: user_id，外键: user_id→UserDirectory.user_id           | 与用户基表 1:1 扩展，存储患者信息                            |
| **Doctor**            | user_id (PK, FK), department_id (FK), title, specialty, work_phone | 主键: user_id，外键: user_id→UserDirectory，department_id→Department | 医生必须从属于某科室                                         |
| **Department**        | department_id (PK), department_name, introduction, location  | 主键: department_id                                          | 科室主数据                                                   |
| **DepartmentManager** | user_id (PK, FK), department_id (FK), work_phone             | 主键: user_id，外键: user_id→UserDirectory，department_id→Department | 部门负责人（与科室建立一对多关系）                           |
| **SystemUser**        | user_id (PK, FK), work_phone                                 | 主键: user_id，外键: user_id→UserDirectory                   | 系统运营/前台等内部账号                                      |
| **DoctorTimeSlot**    | slot_id (PK), doctor_id (FK), department_id (FK), slot_date, start_time, end_time, capacity, booked_count, status, note | 主键: slot_id；外键: doctor_id→Doctor，department_id→Department | 医生出诊时隙；capacity、booked_count可控；status: Open/Closed/Blocked |
| **Registration**      | reg_id (PK), patient_id (FK), doctor_id (FK), department_id (FK), reg_date, reg_status, reg_fee, pay_status, create_time, slot_id (FK 可空) | 主键: reg_id；多外键 →Patient / Doctor / Department / TimeSlot | 挂号记录；pay_status: Unpaid / Paid / Refunded               |
| **MedicalRecord**     | record_id (PK), reg_id (FK unique), diagnosis, treatment_plan, advice, create_time | 主键: record_id；唯一外键 reg_id→Registration.reg_id         | 一次挂号对应 0..1 病历（可配为 1..1）                        |
| **Message**           | message_id (PK), title, content, create_user_id (FK), create_time, is_valid, target_user_id (FK) | 主键: message_id；外键 →UserDirectory                        | 用户站内消息，is_valid 控制撤回/隐藏                         |

------

## **② 数据字典**

------

### **UserDirectory**

| 字段名      | 数据类型 | 长度 | 默认值            | 键       | 说明             | 约束与业务规则           |
| ----------- | -------- | ---- | ----------------- | -------- | ---------------- | ------------------------ |
| user_id     | VARCHAR  | 36   | -                 | PK       | 用户唯一标识     | 系统唯一；其他表共享主键 |
| create_time | DATETIME | -    | CURRENT_TIMESTAMP | -        | 创建时间         | 系统生成                 |
| is_active   | BOOLEAN  | -    | TRUE              | -        | 是否可用         | FALSE 则禁止登录         |
| phone       | VARCHAR  | 20   | NULL              | -        | 联系电话         | 可加唯一约束（可选）     |
| password    | VARCHAR  | 100  | -                 | -        | 登录密码（加密） | 必须 Hash+Salt           |
| user_name   | VARCHAR  | 100  | -                 | 唯一索引 | 显示/登录名      | 系统唯一，3-50 字符      |

------

### **Patient**

| 字段名           | 数据类型    | 说明                    |
| ---------------- | ----------- | ----------------------- |
| user_id (PK, FK) | VARCHAR(36) | 关联 UserDirectory      |
| gender           | VARCHAR(10) | 可选（枚举：M/F/Other） |
| age              | INT         | >=0                     |
| id_card          | VARCHAR(32) | 证件号，可选            |
| money            | INT         | 账户余额（分），>=0     |

------

### **Doctor**

| 字段名             | 类型         | 说明               |
| ------------------ | ------------ | ------------------ |
| user_id (PK, FK)   | VARCHAR(36)  | 关联 UserDirectory |
| department_id (FK) | VARCHAR(36)  | 所属科室（必填）   |
| title              | VARCHAR(100) | 职称               |
| specialty          | VARCHAR(200) | 专业特长           |
| work_phone         | VARCHAR(20)  | 工作电话，可空     |

------

### **Department**

| 字段名             | 类型         | 说明            |
| ------------------ | ------------ | --------------- |
| department_id (PK) | VARCHAR(36)  | 科室ID          |
| department_name    | VARCHAR(100) | 唯一科室名      |
| introduction       | TEXT         | 科室简介        |
| location           | VARCHAR(100) | 楼层/房间等位置 |

------

### **DepartmentManager**

| 字段名             | 类型        | 说明         |
| ------------------ | ----------- | ------------ |
| user_id (PK, FK)   | VARCHAR(36) | 负责人用户ID |
| department_id (FK) | VARCHAR(36) | 管理科室     |
| work_phone         | VARCHAR(20) | 办公电话     |

------

### **SystemUser**

| 字段名           | 类型        | 说明         |
| ---------------- | ----------- | ------------ |
| user_id (PK, FK) | VARCHAR(36) | 系统内部账号 |
| work_phone       | VARCHAR(20) | 办公电话     |

------

### **DoctorTimeSlot**

| 字段名             | 类型        | 说明                    |
| ------------------ | ----------- | ----------------------- |
| slot_id (PK)       | VARCHAR(36) | 时段ID                  |
| doctor_id (FK)     | VARCHAR(36) | 出诊医生                |
| department_id (FK) | VARCHAR(36) | 冗余存储所属科室        |
| slot_date          | DATE        | 出诊日期                |
| start_time         | TIME        | 开诊时间                |
| end_time           | TIME        | 结束时间                |
| capacity           | INT         | 可预约人数，默认 1      |
| booked_count       | INT         | 已预约数                |
| status             | VARCHAR(20) | Open / Closed / Blocked |
| note               | TEXT        | 备注                    |
| create_time        | DATETIME    | 创建时间                |
| update_time        | DATETIME    | 更新时间                |

------

### **Registration**

| 字段名             | 类型        | 说明                         |
| ------------------ | ----------- | ---------------------------- |
| reg_id (PK)        | VARCHAR(36) | 挂号编号                     |
| patient_id (FK)    | VARCHAR(36) | 患者                         |
| doctor_id (FK)     | VARCHAR(36) | 医生                         |
| department_id (FK) | VARCHAR(36) | 科室                         |
| reg_date           | DATE        | 就诊日期                     |
| reg_time_slot      | VARCHAR(50) | 时间段文本（可空）           |
| reg_status         | VARCHAR(20) | Booked / Canceled / Finished |
| reg_fee            | INT         | 挂号费（分）                 |
| pay_status         | VARCHAR(20) | Unpaid / Paid / Refunded     |
| create_time        | DATETIME    | 创建时间                     |
| slot_id (FK，可空) | VARCHAR(36) | 关联具体时段                 |

------

### **MedicalRecord**

| 字段               | 类型        | 说明               |
| ------------------ | ----------- | ------------------ |
| record_id (PK)     | VARCHAR(36) | 病历编号           |
| reg_id (FK + 唯一) | VARCHAR(36) | 挂号记录，对应 1:1 |
| diagnosis          | TEXT        | 诊断               |
| treatment_plan     | TEXT        | 治疗方案           |
| advice             | TEXT        | 医嘱               |
| create_time        | DATETIME    | 创建时间           |

------

### **Message**

| 字段                      | 类型         | 说明                        |
| ------------------------- | ------------ | --------------------------- |
| message_id (PK)           | VARCHAR(36)  | 消息ID                      |
| title                     | VARCHAR(100) | 标题                        |
| content                   | TEXT         | 内容                        |
| create_user_id (FK)       | VARCHAR(36)  | 发送者                      |
| create_time               | DATETIME     | 创建时间                    |
| is_valid                  | BOOLEAN      | 是否有效（逻辑删除 / 撤回） |
| target_user_id (FK，可空) | VARCHAR(36)  | 接收者（为空表示公告）      |