(function(){"use strict";var t={6153:function(t,e,s){var a=s(1529),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("nav",{staticClass:"nav-bar"},[t.isLoggedIn?t._e():e("router-link",{staticClass:"nav-item",attrs:{to:"/login-register"}},[t._v("登录/注册")]),t.isLoggedIn&&t.isPatient?e("router-link",{staticClass:"nav-item",attrs:{to:"/registration"}},[t._v("挂号")]):t._e(),t.isLoggedIn?e("router-link",{staticClass:"nav-item",attrs:{to:"/message"}},[t._v("消息")]):t._e(),t.isLoggedIn?e("router-link",{staticClass:"nav-item",attrs:{to:"/profile"}},[t._v("个人中心")]):t._e(),t.isLoggedIn&&t.isDoctor?e("router-link",{staticClass:"nav-item",attrs:{to:"/doctor-panel"}},[t._v("医生端")]):t._e(),t.isLoggedIn&&t.isDeptManager?e("router-link",{staticClass:"nav-item",attrs:{to:"/dept-panel"}},[t._v("科室端")]):t._e(),t.isLoggedIn&&t.isAdmin?e("router-link",{staticClass:"nav-item",attrs:{to:"/admin-panel"}},[t._v("系统管理")]):t._e()],1),e("div",{staticClass:"page-container"},[e("router-view")],1)])},o=[],i=(s(8335),{data(){return{userInfo:null}},computed:{isLoggedIn(){return!!this.userInfo},isPatient(){return this.userInfo&&"patient"===this.userInfo.role},isDoctor(){return this.userInfo&&"doctor"===this.userInfo.role},isDeptManager(){return this.userInfo&&"dept_manager"===this.userInfo.role},isAdmin(){return this.userInfo&&"admin"===this.userInfo.role}},created(){this.refreshUserInfo()},watch:{$route(){this.refreshUserInfo()}},methods:{refreshUserInfo(){const t=localStorage.getItem("userInfo");if(t)try{this.userInfo=JSON.parse(t)}catch(e){this.userInfo=null}else this.userInfo=null}}}),n=i,l=s(1656),c=(0,l.A)(n,r,o,!1,null,null,null),d=c.exports,m=s(3475),u=(s(8111),s(1701),function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-register"},[e("div",{staticClass:"tab-header"},[e("div",{staticClass:"tab-item",class:{active:t.isLogin},on:{click:function(e){t.isLogin=!0}}},[t._v("登录")]),e("div",{staticClass:"tab-item",class:{active:!t.isLogin},on:{click:function(e){t.isLogin=!1}}},[t._v("注册")])]),t.isLogin?e("div",{staticClass:"form-container"},[e("div",{staticClass:"form-item"},[e("label",[t._v("手机号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginId,expression:"loginId"}],staticClass:"input",attrs:{type:"tel",placeholder:"请输入手机号或账号"},domProps:{value:t.loginId},on:{input:function(e){e.target.composing||(t.loginId=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginPassword,expression:"loginPassword"}],staticClass:"input",attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:t.loginPassword},on:{input:function(e){e.target.composing||(t.loginPassword=e.target.value)}}})]),e("button",{staticClass:"submit-btn",on:{click:t.handleLogin}},[t._v("登录")])]):e("div",{staticClass:"form-container"},[e("div",{staticClass:"form-item"},[e("label",[t._v("姓名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.patientName,expression:"registerForm.patientName"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入姓名"},domProps:{value:t.registerForm.patientName},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"patientName",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("性别：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.gender,expression:"registerForm.gender"}],staticClass:"input",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.registerForm,"gender",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:""}},[t._v("请选择")]),e("option",{attrs:{value:"男"}},[t._v("男")]),e("option",{attrs:{value:"女"}},[t._v("女")])])]),e("div",{staticClass:"form-item"},[e("label",[t._v("年龄：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.registerForm.age,expression:"registerForm.age",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",min:"0",placeholder:"请输入年龄"},domProps:{value:t.registerForm.age},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"age",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("手机号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.phone,expression:"registerForm.phone"}],staticClass:"input",attrs:{type:"tel",placeholder:"请输入手机号"},domProps:{value:t.registerForm.phone},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"phone",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.password,expression:"registerForm.password"}],staticClass:"input",attrs:{type:"password",placeholder:"请设置密码"},domProps:{value:t.registerForm.password},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("身份证号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.idCard,expression:"registerForm.idCard"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入身份证号"},domProps:{value:t.registerForm.idCard},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"idCard",e.target.value)}}})]),e("button",{staticClass:"submit-btn",on:{click:t.handleRegister}},[t._v("注册")])])])}),p=[],v=(s(4114),s(3110),s(8207));const g=v.A.create({baseURL:"/api"});g.interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers["X-User-Id"]=e),t});var h=g,_={data(){return{isLogin:!0,loginId:"",loginPassword:"",registerForm:{patientName:"",gender:"",age:null,phone:"",password:"",idCard:""}}},methods:{async handleLogin(){if(this.loginId&&this.loginPassword)try{const t=await h.post("/auth/login",{id:this.loginId,password:this.loginPassword}),e=t.data;if(0!==e.error_code)return void alert(e.msg||"登录失败");const s=e.data;localStorage.setItem("token",s.token),localStorage.setItem("userInfo",JSON.stringify(s)),this.$router.push("/profile")}catch(t){console.error(t),alert("登录请求失败，请稍后重试")}else alert("请填写账号和密码")},async handleRegister(){const t=this.registerForm;if(t.patientName&&t.gender&&t.age&&t.phone&&t.password&&t.idCard)try{const e=await h.post("/auth/patient/register",t),s=e.data;if(0!==s.error_code)return void alert(s.msg||"注册失败");alert("注册成功，请使用手机号登录"),this.isLogin=!0,this.loginId=t.phone}catch(e){console.error(e),alert("注册请求失败，请稍后重试")}else alert("请完整填写注册信息")}}},f=_,C=(0,l.A)(f,u,p,!1,null,"29167747",null),I=C.exports,y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"registration-page"},[e("h2",[t._v("门诊挂号")]),e("div",{staticClass:"dept-select"},[e("label",[t._v("选择科室：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedDeptId,expression:"selectedDeptId"}],staticClass:"select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.selectedDeptId=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:""}},[t._v("请选择科室")]),t._l(t.departmentList,function(s){return e("option",{key:s.departmentId,domProps:{value:s.departmentId}},[t._v(" "+t._s(s.departmentName)+"（"+t._s(s.location)+"） ")])})],2)]),e("div",{staticClass:"date-select"},[e("label",[t._v("就诊日期：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedDate,expression:"selectedDate"}],staticClass:"select",attrs:{type:"date"},domProps:{value:t.selectedDate},on:{input:function(e){e.target.composing||(t.selectedDate=e.target.value)}}})]),e("div",{staticClass:"card-list"},[t._l(t.doctorList,function(s){return e("RegistrationCard",{key:s.userId,attrs:{doctorName:s.doctorName,department:t.getDeptName(s.departmentId),title:s.title,timeSlots:s.availableSlots},on:{register:e=>t.handleRegister(s,e)}})}),0===t.doctorList.length?e("div",{staticClass:"empty-tip"},[t._v(" 请先选择科室和日期，将自动加载可预约医生 ")]):t._e()],2)])},b=[],w=(s(116),function(){var t=this,e=t._self._c;return e("div",{staticClass:"regist-card"},[e("h3",[t._v(t._s(t.doctorName))]),e("p",{staticClass:"dept"},[t._v(t._s(t.department))]),e("div",{staticClass:"info"},[e("span",[t._v("职称："+t._s(t.title))]),t.timeSlots&&t.timeSlots.length?e("span",[t._v("可约时段：")]):t._e()]),t.timeSlots&&t.timeSlots.length?e("div",{staticClass:"slot-select"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedSlot,expression:"selectedSlot"}],staticClass:"slot-input",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.selectedSlot=e.target.multiple?s:s[0]}}},[e("option",{attrs:{disabled:"",value:""}},[t._v("请选择时段")]),t._l(t.timeSlots,function(s){return e("option",{key:s.slotId,domProps:{value:s.slotId}},[t._v(" "+t._s(t.formatSlot(s))+" ")])})],2)]):t._e(),e("button",{staticClass:"btn",class:{disabled:!t.timeSlots||!t.timeSlots.length},attrs:{disabled:!t.timeSlots||!t.timeSlots.length},on:{click:t.handleRegister}},[t._v(" "+t._s(t.timeSlots&&t.timeSlots.length?"立即挂号":"暂无号源")+" ")])])}),F=[],N={props:{doctorName:String,department:String,title:String,timeSlots:{type:Array,default:()=>[]}},data(){return{selectedSlot:""}},methods:{formatSlot(t){return t?t.label?t.label+`（剩余 ${t.remain}）`:t.startTime&&t.endTime?`${t.startTime}-${t.endTime}（剩余 ${t.remain}）`:`剩余 ${t.remain}`:""},handleRegister(){if(!this.timeSlots||!this.timeSlots.length)return void alert("该日期暂无可预约号源，请尝试更换日期或科室");if(!this.selectedSlot)return void alert("请先选择就诊时段");const t=this.timeSlots.find(t=>t.slotId===this.selectedSlot);this.$emit("register",t)}}},x=N,P=(0,l.A)(x,w,F,!1,null,"87c825f4",null),D=P.exports,S={components:{RegistrationCard:D},data(){return{departmentList:[],selectedDeptId:"",selectedDate:"",doctorList:[]}},created(){this.loadDepartments()},watch:{selectedDeptId(){this.loadDoctors()},selectedDate(){this.loadDoctors()}},methods:{async loadDepartments(){try{const t=await h.get("/departments"),e=t.data;0===e.error_code&&(this.departmentList=e.data||[])}catch(t){console.error(t)}},async loadDoctors(){if(this.selectedDeptId&&this.selectedDate)try{const t=await h.get("/doctors",{params:{departmentId:this.selectedDeptId,date:this.selectedDate}}),e=t.data;0===e.error_code?this.doctorList=e.data||[]:this.doctorList=[]}catch(t){console.error(t),this.doctorList=[]}else this.doctorList=[]},async handleRegister(t,e){if(this.selectedDate&&this.selectedDeptId)if(e&&e.slotId)try{const s=await h.post("/registrations",{doctorId:t.userId,departmentId:this.selectedDeptId,regDate:this.selectedDate,slotId:e.slotId}),a=s.data;0===a.error_code?alert("挂号成功："+a.data.regId):alert(a.msg||"挂号失败")}catch(s){console.error(s),alert("挂号请求失败，请稍后重试")}else alert("请选择有效的就诊时段");else alert("请先选择日期和科室")},getDeptName(t){const e=this.departmentList.find(e=>e.departmentId===t);return e?e.departmentName:""}}},k=S,$=(0,l.A)(k,y,b,!1,null,"9f61a402",null),U=$.exports,T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"message-page"},[e("h2",[t._v("消息中心")]),e("div",{staticClass:"message-layout"},[e("div",{staticClass:"conversation-sidebar"},[t._l(t.conversations,function(s){return e("div",{key:s.contactUserId,class:["conv-item",s.contactUserId===t.selectedContactId?"active":""],on:{click:function(e){t.selectedContactId=s.contactUserId}}},[e("div",{staticClass:"conv-avatar"},[t._v(" "+t._s((s.contactUserName||s.contactUserId||"").charAt(0)||"用")+" ")]),e("div",{staticClass:"conv-main"},[e("div",{staticClass:"conv-header"},[e("span",{staticClass:"conv-name"},[t._v(" "+t._s(t.formatDisplayName(s.contactUserName,s.contactUserId))+" ")]),e("span",{staticClass:"conv-time"},[t._v(t._s(t.formatTime(s.lastTime)))])]),e("div",{staticClass:"conv-preview"},[t._v(" "+t._s(s.lastTitle||s.lastContent)+" ")])])])}),t.conversations.length?t._e():e("div",{staticClass:"empty-tip sidebar-empty"},[t._v(" 暂无会话 ")])],2),e("div",{staticClass:"message-main"},[t.canSend?e("div",{staticClass:"send-box"},[t.isPatient?e("h3",[t._v("给就诊医生发消息")]):t.isDoctor?e("h3",[t._v("给患者 / 管理员发消息")]):e("h3",[t._v("发送系统消息")]),e("div",{staticClass:"form-item"},[e("label",[t._v("选择对象：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedContactId,expression:"selectedContactId"}],staticClass:"select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.selectedContactId=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:""}},[t._v("请选择")]),t._l(t.contactOptions,function(s){return e("option",{key:s.userId,domProps:{value:s.userId}},[t._v(" "+t._s(s.displayName)+" ")])})],2)]),e("div",{staticClass:"form-item"},[e("label",[t._v("标题：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("内容：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"textarea",attrs:{rows:"3"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),e("button",{staticClass:"btn",on:{click:t.sendMessage}},[t._v("发送")])]):t._e(),t.canSend?e("div",{staticClass:"chat-box"},[e("h3",{staticClass:"chat-title"},[t._v(" 对话记录 "),t.currentContactName?e("span",[t._v("（当前对象："+t._s(t.currentContactName)+"）")]):t._e()]),t.selectedContactId?e("div",{staticClass:"chat-list"},[t._l(t.conversation,function(s){return e("div",{key:s.messageId,class:["chat-item",s.createUserId===t.userInfo.userId?"from-me":"from-other"]},[e("div",{staticClass:"chat-meta"},[e("span",{staticClass:"chat-sender"},[t._v(" "+t._s(s.createUserId===t.userInfo.userId?"我":s.createUserName||"对方")+" ")]),e("span",{staticClass:"chat-time"},[t._v(t._s(t.formatTime(s.createTime)))])]),s.title?e("div",{staticClass:"chat-title-text"},[t._v(" "+t._s(s.title)+" ")]):t._e(),e("div",{staticClass:"chat-content"},[t._v(" "+t._s(s.content)+" ")])])}),0===t.conversation.length?e("div",{staticClass:"empty-tip"},[t._v(" 暂无历史消息 ")]):t._e()],2):e("div",{staticClass:"empty-tip"},[t._v(" 请选择对象后查看与你之间的消息记录 ")])]):t._e(),e("div",{staticClass:"msg-list"},[e("h3",[t._v("系统消息")]),t._l(t.msgList,function(s){return e("MessageCard",{key:s.messageId,attrs:{title:s.title,content:s.content,time:t.formatTime(s.createTime),subtitle:t.formatSender(s)}})}),0===t.msgList.length?e("div",{staticClass:"empty-tip"},[t._v(" 暂无系统消息 ")]):t._e()],2)])])])},R=[],A=(s(7588),function(){var t=this,e=t._self._c;return e("div",{staticClass:"msg-card"},[t.subtitle?e("div",{staticClass:"msg-subtitle"},[t._v(t._s(t.subtitle))]):t._e(),e("div",{staticClass:"msg-title"},[t._v(t._s(t.title))]),e("div",{staticClass:"msg-content"},[t._v(t._s(t.content))]),e("div",{staticClass:"msg-time"},[t._v(t._s(t.time))])])}),L=[],M={props:{title:String,content:String,time:String,subtitle:String}},O=M,Q=(0,l.A)(O,A,L,!1,null,"77f1443a",null),j=Q.exports,z={components:{MessageCard:j},data(){return{msgList:[],userInfo:null,contactOptions:[],selectedContactId:"",title:"",content:"",conversation:[],conversations:[]}},created(){const t=localStorage.getItem("userInfo");t&&(this.userInfo=JSON.parse(t)),this.loadMessages(),this.loadContacts(),this.loadConversations()},methods:{async loadMessages(){try{const t=await h.get("/messages",{params:{box:"inbox",isValid:!0}}),e=t.data;0===e.error_code&&(this.msgList=e.data||[])}catch(t){console.error(t)}},async loadConversations(){try{const t=await h.get("/messages/conversations"),e=t.data;0===e.error_code&&(this.conversations=e.data||[])}catch(t){console.error(t)}},async loadContacts(){if(this.isPatient)try{const t=await h.get("/registrations"),e=t.data;if(0===e.error_code){const t=e.data||[],s={};t.forEach(t=>{s[t.doctorId]||(s[t.doctorId]={userId:t.doctorId,displayName:this.formatDisplayName(`${t.doctorName||t.doctorId}${t.departmentName?" - "+t.departmentName:""}`,t.doctorId)})}),this.contactOptions=Object.values(s)}}catch(t){console.error(t)}else try{const t=await h.get("/messages/conversations"),e=t.data;if(0===e.error_code){const t=e.data||[];this.contactOptions=t.map(t=>({userId:t.contactUserId,displayName:this.formatDisplayName(t.contactUserName,t.contactUserId)}))}}catch(t){console.error(t)}},async sendMessage(){if(this.canSend)if(this.selectedContactId&&this.title&&this.content)try{const t=await h.post("/messages",{targetUserId:this.selectedContactId,title:this.title,content:this.content}),e=t.data;0===e.error_code?(alert("发送成功"),this.title="",this.content="",this.loadConversation(),this.loadConversations()):alert(e.msg||"发送失败")}catch(t){console.error(t),alert("发送请求失败，请稍后重试")}else alert("请先选择对象并填写标题和内容");else alert("当前角色暂不支持发送消息")},async loadConversation(){if(this.canSend&&this.selectedContactId)try{const t=await h.get("/messages/conversation",{params:{targetUserId:this.selectedContactId}}),e=t.data;0===e.error_code&&(this.conversation=e.data||[])}catch(t){console.error(t)}else this.conversation=[]},formatTime(t){return t?String(t).replace("T"," ").substring(0,16):""},formatSender(t){const e=t.createUserName||t.createUserId||"",s=t.createUserId||"";return e||s?`来自：${e}${s?"（"+s+"）":""}`:""},formatDisplayName(t,e){return e||t?t&&e?`${t}（${e}）`:t||e:""}},computed:{isPatient(){return this.userInfo&&"patient"===this.userInfo.role},isDoctor(){return this.userInfo&&"doctor"===this.userInfo.role},canSend(){return this.userInfo&&["patient","doctor","admin","dept_manager"].includes(this.userInfo.role)},currentContactName(){const t=this.contactOptions.find(t=>t.userId===this.selectedContactId);return t?t.displayName:""}},watch:{selectedContactId(){this.loadConversation()}}},J=z,B=(0,l.A)(J,T,R,!1,null,"220dc60d",null),E=B.exports,q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"profile-page"},[e("h2",[t._v("个人中心")]),e("div",{staticClass:"profile-info"},[e("div",{staticClass:"avatar"},[e("div",{staticClass:"avatar-circle"},[t._v(t._s(t.avatarText))])]),e("div",{staticClass:"user-info"},[e("p",{staticClass:"name"},[t._v("用户名："+t._s(t.userInfo.username))]),e("p",{staticClass:"phone"},[t._v("用户ID："+t._s(t.userInfo.userId))]),e("p",{staticClass:"id-card"},[t._v("角色："+t._s(t.userInfo.role))])])]),e("div",{staticClass:"profile-menu"},[e("div",{staticClass:"menu-item",on:{click:t.showRegistrations}},[t._v("我的挂号记录")]),e("div",{staticClass:"menu-item",on:{click:t.showMedicalRecords}},[t._v("我的就诊记录")]),e("div",{staticClass:"menu-item",on:{click:t.changePassword}},[t._v("修改密码")]),e("div",{staticClass:"menu-item",on:{click:t.logout}},[t._v("退出登录")])]),t.isPatient?e("div",{staticClass:"balance-panel"},[e("p",[t._v("账户余额：¥ "+t._s((t.balance/100).toFixed(2)))]),e("div",{staticClass:"recharge"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.rechargeAmount,expression:"rechargeAmount",modifiers:{number:!0}}],attrs:{type:"number",min:"0",step:"0.01",placeholder:"充值金额（元）"},domProps:{value:t.rechargeAmount},on:{input:function(e){e.target.composing||(t.rechargeAmount=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.recharge}},[t._v("充值")])])]):t._e(),t.registrations.length?e("div",{staticClass:"reg-list"},[e("h3",[t._v("挂号记录")]),e("table",{staticClass:"table"},[t._m(0),e("tbody",t._l(t.registrations,function(s){return e("tr",{key:s.regId},[e("td",[t._v(t._s(s.regDate))]),e("td",[t._v(t._s(t.formatSlot(s.regTimeSlot)))]),e("td",[t._v(t._s(s.departmentName||s.departmentId))]),e("td",[t._v(t._s(s.departmentLocation||"-"))]),e("td",[t._v(t._s(s.doctorName||s.doctorId))]),e("td",[t._v("¥ "+t._s(30..toFixed(2)))]),e("td",[t._v(t._s(s.regStatus)+" / "+t._s(s.payStatus))]),e("td",["Booked"===s.regStatus&&"Unpaid"===s.payStatus?e("button",{on:{click:function(e){return t.pay(s)}}},[t._v(" 支付 ")]):t._e(),"Booked"===s.regStatus?e("button",{on:{click:function(e){return t.cancel(s)}}},[t._v(" 取消 ")]):t._e()])])}),0)])]):t._e(),t.medicalRecords.length?e("div",{staticClass:"record-list"},[e("h3",[t._v("就诊记录")]),e("table",{staticClass:"table"},[e("thead",[e("tr",[e("th",[t._v("日期")]),e("th",[t._v("时段")]),e("th",[t._v("科室")]),e("th",[t._v("地点")]),e("th",[t._v(t._s(t.isPatient?"医生":"患者"))]),e("th",[t._v("诊断")]),e("th",[t._v("医嘱")])])]),e("tbody",t._l(t.medicalRecords,function(s){return e("tr",{key:s.recordId},[e("td",[t._v(t._s(s.regDate))]),e("td",[t._v(t._s(t.formatSlot(s.regTimeSlot)))]),e("td",[t._v(t._s(s.departmentName||s.departmentId))]),e("td",[t._v(t._s(s.departmentLocation||"-"))]),e("td",[t._v(t._s(t.isPatient?s.doctorName:s.patientName))]),e("td",[t._v(t._s(s.diagnosis))]),e("td",[t._v(t._s(s.advice))])])}),0)])]):t._e()])},V=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("日期")]),e("th",[t._v("时段")]),e("th",[t._v("科室")]),e("th",[t._v("地点")]),e("th",[t._v("医生")]),e("th",[t._v("费用")]),e("th",[t._v("状态")]),e("th",[t._v("操作")])])])}],X={data(){return{userInfo:{username:"",userId:"",role:""},registrations:[],medicalRecords:[],balance:0,rechargeAmount:null}},computed:{avatarText(){return this.userInfo&&this.userInfo.username?this.userInfo.username.charAt(0):"doctor"===this.userInfo.role?"医":"admin"===this.userInfo.role?"管":"dept_manager"===this.userInfo.role?"科":"用"},isPatient(){return"patient"===this.userInfo.role}},created(){const t=localStorage.getItem("userInfo");t&&(this.userInfo=JSON.parse(t)),this.loadProfile()},methods:{async loadProfile(){if(this.isPatient)try{const t=await h.get("/patient/me"),e=t.data;0===e.error_code&&e.data&&(this.balance=e.data.balance||0)}catch(t){console.error(t)}},async showRegistrations(){try{if(this.isPatient){const t=await h.get("/registrations"),e=t.data;0===e.error_code&&(this.registrations=e.data||[])}else if("doctor"===this.userInfo.role){const t=await h.get("/doctor/registrations"),e=t.data;0===e.error_code&&(this.registrations=e.data||[])}else this.registrations=[]}catch(t){console.error(t),this.registrations=[]}},async showMedicalRecords(){try{if(this.isPatient){const t=await h.get("/medical-records"),e=t.data;0===e.error_code&&(this.medicalRecords=e.data||[])}else if("doctor"===this.userInfo.role){const t=await h.get("/medical-records/doctor"),e=t.data;0===e.error_code&&(this.medicalRecords=e.data||[])}else this.medicalRecords=[]}catch(t){console.error(t),this.medicalRecords=[]}},async pay(t){if(confirm("确认支付该挂号费用？"))try{const e=await h.post(`/registrations/${t.regId}/pay`,null,{params:{payChannel:"Balance"}}),s=e.data;0===s.error_code?(alert("支付成功"),this.showRegistrations(),this.loadProfile()):alert(s.msg||"支付失败")}catch(e){console.error(e),alert("支付请求失败")}},async cancel(t){if(confirm("确认取消该挂号？已支付的将扣除一定手续费。"))try{const e=await h.post(`/registrations/${t.regId}/cancel`),s=e.data;0===s.error_code?(alert("取消成功"),this.showRegistrations(),this.loadProfile()):alert(s.msg||"取消失败")}catch(e){console.error(e),alert("取消请求失败")}},async recharge(){if(this.isPatient)if(!this.rechargeAmount||this.rechargeAmount<=0)alert("请输入大于 0 的充值金额");else try{const t=await h.post("/patient/recharge",{amount:this.rechargeAmount}),e=t.data;0===e.error_code?(alert("充值成功"),this.rechargeAmount=null,this.loadProfile()):alert(e.msg||"充值失败")}catch(t){console.error(t),alert("充值请求失败")}},async changePassword(){const t=window.prompt("请输入原密码");if(!t)return;const e=window.prompt("请输入新密码");if(e)try{const s=await h.post("/auth/change-password",{oldPassword:t,newPassword:e}),a=s.data;alert(a.msg||"修改完成")}catch(s){console.error(s),alert("修改密码失败")}},logout(){localStorage.removeItem("token"),localStorage.removeItem("userInfo"),this.$router.push("/login-register")},formatSlot(t){const e={"AM-1":"上午 09:00-10:00","AM-2":"上午 10:00-11:00","PM-1":"下午 14:00-15:00","PM-2":"下午 15:00-16:00"};return e[t]||t}}},G=X,H=(0,l.A)(G,q,V,!1,null,"a191cff0",null),K=H.exports,W=function(){var t=this,e=t._self._c;return e("div",{staticClass:"doctor-panel"},[e("h2",[t._v("医生工作台")]),e("p",{staticClass:"tip"},[t._v("本页面用于医生查看当天挂号患者，并向患者发送系统消息。")]),e("div",{staticClass:"reg-section"},[e("h3",[t._v("挂号患者列表")]),e("div",{staticClass:"reg-filter"},[e("label",[t._v("就诊日期：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.regDate,expression:"regDate"}],staticClass:"input",attrs:{type:"date"},domProps:{value:t.regDate},on:{input:function(e){e.target.composing||(t.regDate=e.target.value)}}}),e("button",{staticClass:"btn small",on:{click:t.loadRegistrations}},[t._v("刷新")])]),t.registrations.length?e("table",{staticClass:"reg-table"},[t._m(0),e("tbody",t._l(t.registrations,function(s){return e("tr",{key:s.regId},[e("td",[t._v(t._s(s.regId))]),e("td",[t._v(t._s(s.patientId))]),e("td",[t._v(t._s(s.patientName))]),e("td",[t._v(t._s(s.regDate))]),e("td",[t._v(t._s(s.regTimeSlot))]),e("td",[t._v(t._s(s.regStatus))]),e("td",[t._v(t._s(s.payStatus))]),e("td",[e("button",{staticClass:"btn small",on:{click:function(e){return t.fillTarget(s.patientId)}}},[t._v("写消息")]),e("button",{staticClass:"btn small",on:{click:function(e){return t.openRecordForm(s)}}},[t._v("写病历")])])])}),0)]):e("div",{staticClass:"empty-tip"},[t._v("当前日期暂无挂号记录。")])]),e("div",{staticClass:"form"},[e("div",{staticClass:"form-item"},[e("label",[t._v("目标用户ID：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.targetUserId,expression:"targetUserId"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入患者的 UserID"},domProps:{value:t.targetUserId},on:{input:function(e){e.target.composing||(t.targetUserId=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("标题：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入消息标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("内容：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"textarea",attrs:{rows:"4",placeholder:"请输入消息内容"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),e("button",{staticClass:"btn",on:{click:t.sendMessage}},[t._v("发送消息")])]),t.showRecordForm?e("div",{staticClass:"form"},[e("h3",[t._v("录入诊疗记录")]),e("div",{staticClass:"form-item"},[e("label",[t._v("挂号号：")]),e("span",[t._v(t._s(t.recordForm.regId))])]),e("div",{staticClass:"form-item"},[e("label",[t._v("患者：")]),e("span",[t._v(t._s(t.recordForm.patientName)+"（"+t._s(t.recordForm.patientId)+"）")])]),e("div",{staticClass:"form-item"},[e("label",[t._v("诊断：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.recordForm.diagnosis,expression:"recordForm.diagnosis"}],staticClass:"textarea",attrs:{rows:"3"},domProps:{value:t.recordForm.diagnosis},on:{input:function(e){e.target.composing||t.$set(t.recordForm,"diagnosis",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("治疗方案：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.recordForm.treatmentPlan,expression:"recordForm.treatmentPlan"}],staticClass:"textarea",attrs:{rows:"3"},domProps:{value:t.recordForm.treatmentPlan},on:{input:function(e){e.target.composing||t.$set(t.recordForm,"treatmentPlan",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("医嘱：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.recordForm.advice,expression:"recordForm.advice"}],staticClass:"textarea",attrs:{rows:"3"},domProps:{value:t.recordForm.advice},on:{input:function(e){e.target.composing||t.$set(t.recordForm,"advice",e.target.value)}}})]),e("button",{staticClass:"btn",on:{click:t.saveRecord}},[t._v("保存病历")]),e("button",{staticClass:"btn small",staticStyle:{"margin-left":"10px"},on:{click:function(e){t.showRecordForm=!1}}},[t._v("关闭")])]):t._e(),e("h3",{staticClass:"sub-title"},[t._v("已发送消息（发件箱）")]),e("div",{staticClass:"msg-list"},[t._l(t.outbox,function(s){return e("MessageCard",{key:s.messageId,attrs:{title:s.title,content:s.content,time:t.formatTime(s.createTime)}})}),t.outbox.length?t._e():e("div",{staticClass:"empty-tip"},[t._v("暂无已发送消息")])],2)])},Y=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("挂号号")]),e("th",[t._v("患者ID")]),e("th",[t._v("患者姓名")]),e("th",[t._v("日期")]),e("th",[t._v("时段")]),e("th",[t._v("状态")]),e("th",[t._v("支付状态")]),e("th",[t._v("操作")])])])}],Z={components:{MessageCard:j},data(){return{regDate:"",registrations:[],targetUserId:"",title:"",content:"",outbox:[],showRecordForm:!1,recordForm:{regId:"",patientId:"",patientName:"",diagnosis:"",treatmentPlan:"",advice:""}}},created(){const t=new Date;this.regDate=t.toISOString().slice(0,10),this.loadRegistrations(),this.loadOutbox()},methods:{async loadRegistrations(){try{const t=await h.get("/doctor/registrations",{params:{date:this.regDate||null}}),e=t.data;0===e.error_code?this.registrations=e.data||[]:this.registrations=[]}catch(t){console.error(t),this.registrations=[]}},fillTarget(t){this.targetUserId=t},openRecordForm(t){this.recordForm={regId:t.regId,patientId:t.patientId,patientName:t.patientName,diagnosis:"",treatmentPlan:"",advice:""},this.showRecordForm=!0},async sendMessage(){if(this.targetUserId&&this.title&&this.content)try{const t=await h.post("/messages",{targetUserId:this.targetUserId,title:this.title,content:this.content}),e=t.data;0===e.error_code?(alert("发送成功"),this.title="",this.content="",this.loadOutbox()):alert(e.msg||"发送失败")}catch(t){console.error(t),alert("发送请求失败，请稍后重试")}else alert("请完整填写目标用户、标题和内容")},async loadOutbox(){try{const t=await h.get("/messages",{params:{box:"outbox"}}),e=t.data;0===e.error_code&&(this.outbox=e.data||[])}catch(t){console.error(t)}},async saveRecord(){if(this.recordForm.regId&&this.recordForm.diagnosis)try{const t=await h.post("/medical-records",{regId:this.recordForm.regId,diagnosis:this.recordForm.diagnosis,treatmentPlan:this.recordForm.treatmentPlan,advice:this.recordForm.advice}),e=t.data;0===e.error_code?(alert("病历保存成功"),this.showRecordForm=!1):alert(e.msg||"保存失败")}catch(t){console.error(t),alert("保存请求失败，请稍后重试")}else alert("请至少填写挂号号和诊断")},formatTime(t){return t?String(t).replace("T"," ").substring(0,16):""}}},tt=Z,et=(0,l.A)(tt,W,Y,!1,null,"14933d16",null),st=et.exports,at=function(){var t=this,e=t._self._c;return e("div",{staticClass:"admin-panel"},[e("h2",[t._v("管理员用户管理")]),e("p",{staticClass:"tip"},[t._v("通过用户 ID 冻结 / 解冻账号，并创建医生 / 科室管理员 / 系统管理员账号。")]),e("div",{staticClass:"form"},[e("div",{staticClass:"form-item"},[e("label",[t._v("用户ID：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userId,expression:"userId"}],staticClass:"input",attrs:{type:"text",placeholder:"例如：P2023... / DR0001"},domProps:{value:t.userId},on:{input:function(e){e.target.composing||(t.userId=e.target.value)}}})]),e("div",{staticClass:"btn-group"},[e("button",{staticClass:"btn freeze",on:{click:t.freezeUser}},[t._v("冻结")]),e("button",{staticClass:"btn unfreeze",on:{click:t.unfreezeUser}},[t._v("解冻")])]),t.resultMsg?e("p",{staticClass:"result"},[t._v(t._s(t.resultMsg))]):t._e()]),e("div",{staticClass:"form create-form"},[e("h3",[t._v("创建医生账号")]),e("div",{staticClass:"form-item"},[e("label",[t._v("姓名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.doctorName,expression:"doctorForm.doctorName"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.doctorForm.doctorName},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"doctorName",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("手机号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.phone,expression:"doctorForm.phone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.doctorForm.phone},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"phone",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.password,expression:"doctorForm.password"}],staticClass:"input",attrs:{type:"password"},domProps:{value:t.doctorForm.password},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("科室：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.departmentId,expression:"doctorForm.departmentId"}],staticClass:"input",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.doctorForm,"departmentId",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:""}},[t._v("请选择科室")]),t._l(t.departments,function(s){return e("option",{key:s.departmentId,domProps:{value:s.departmentId}},[t._v(" "+t._s(s.departmentName)+"（"+t._s(s.departmentId)+"） ")])})],2)]),e("div",{staticClass:"form-item"},[e("label",[t._v("职称：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.title,expression:"doctorForm.title"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.doctorForm.title},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"title",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("专长：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.specialty,expression:"doctorForm.specialty"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.doctorForm.specialty},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"specialty",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("办公电话：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.doctorForm.workPhone,expression:"doctorForm.workPhone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.doctorForm.workPhone},on:{input:function(e){e.target.composing||t.$set(t.doctorForm,"workPhone",e.target.value)}}})]),e("button",{staticClass:"btn create",on:{click:t.createDoctor}},[t._v("创建医生")])]),e("div",{staticClass:"form create-form"},[e("h3",[t._v("创建科室管理员账号")]),e("div",{staticClass:"form-item"},[e("label",[t._v("姓名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.deptForm.userName,expression:"deptForm.userName"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.deptForm.userName},on:{input:function(e){e.target.composing||t.$set(t.deptForm,"userName",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("手机号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.deptForm.phone,expression:"deptForm.phone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.deptForm.phone},on:{input:function(e){e.target.composing||t.$set(t.deptForm,"phone",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.deptForm.password,expression:"deptForm.password"}],staticClass:"input",attrs:{type:"password"},domProps:{value:t.deptForm.password},on:{input:function(e){e.target.composing||t.$set(t.deptForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("科室：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.deptForm.departmentId,expression:"deptForm.departmentId"}],staticClass:"input",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.deptForm,"departmentId",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:""}},[t._v("请选择科室")]),t._l(t.departments,function(s){return e("option",{key:s.departmentId,domProps:{value:s.departmentId}},[t._v(" "+t._s(s.departmentName)+"（"+t._s(s.departmentId)+"） ")])})],2)]),e("div",{staticClass:"form-item"},[e("label",[t._v("办公电话：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.deptForm.workPhone,expression:"deptForm.workPhone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.deptForm.workPhone},on:{input:function(e){e.target.composing||t.$set(t.deptForm,"workPhone",e.target.value)}}})]),e("button",{staticClass:"btn create",on:{click:t.createDeptManager}},[t._v("创建科室管理员")])]),e("div",{staticClass:"form create-form"},[e("h3",[t._v("创建系统管理员账号")]),e("div",{staticClass:"form-item"},[e("label",[t._v("姓名：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.sysForm.userName,expression:"sysForm.userName"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.sysForm.userName},on:{input:function(e){e.target.composing||t.$set(t.sysForm,"userName",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("手机号：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.sysForm.phone,expression:"sysForm.phone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.sysForm.phone},on:{input:function(e){e.target.composing||t.$set(t.sysForm,"phone",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("密码：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.sysForm.password,expression:"sysForm.password"}],staticClass:"input",attrs:{type:"password"},domProps:{value:t.sysForm.password},on:{input:function(e){e.target.composing||t.$set(t.sysForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("label",[t._v("办公电话：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.sysForm.workPhone,expression:"sysForm.workPhone"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.sysForm.workPhone},on:{input:function(e){e.target.composing||t.$set(t.sysForm,"workPhone",e.target.value)}}})]),e("button",{staticClass:"btn create",on:{click:t.createSystemUser}},[t._v("创建系统管理员")])])])},rt=[],ot={data(){return{userId:"",resultMsg:"",departments:[],doctorForm:{doctorName:"",phone:"",password:"",departmentId:"",title:"",specialty:"",workPhone:""},deptForm:{userName:"",phone:"",password:"",departmentId:"",workPhone:""},sysForm:{userName:"",phone:"",password:"",workPhone:""}}},created(){this.loadDepartments()},methods:{async loadDepartments(){try{const t=await h.get("/departments"),e=t.data;0===e.error_code&&(this.departments=e.data||[])}catch(t){console.error(t)}},async freezeUser(){if(this.userId)try{const t=await h.post(`/users/${this.userId}/freeze`),e=t.data;this.resultMsg=e.msg||"操作完成"}catch(t){console.error(t),this.resultMsg="冻结失败，请检查用户ID或稍后重试"}else alert("请先输入用户ID")},async unfreezeUser(){if(this.userId)try{const t=await h.post(`/users/${this.userId}/unfreeze`),e=t.data;this.resultMsg=e.msg||"操作完成"}catch(t){console.error(t),this.resultMsg="解冻失败，请检查用户ID或稍后重试"}else alert("请先输入用户ID")},async createDoctor(){const t=this.doctorForm;if(t.doctorName&&t.phone&&t.password&&t.departmentId)try{const e=await h.post("/users/doctors",t),s=e.data;alert(s.msg||"创建完成")}catch(e){console.error(e),alert("创建医生失败")}else alert("请至少填写姓名、手机号、密码和科室ID")},async createDeptManager(){const t=this.deptForm;if(t.userName&&t.phone&&t.password&&t.departmentId)try{const e=await h.post("/users/dept-managers",t),s=e.data;alert(s.msg||"创建完成")}catch(e){console.error(e),alert("创建科室管理员失败")}else alert("请至少填写姓名、手机号、密码和科室ID")},async createSystemUser(){const t=this.sysForm;if(t.userName&&t.phone&&t.password)try{const e=await h.post("/users/system-users",t),s=e.data;alert(s.msg||"创建完成")}catch(e){console.error(e),alert("创建系统管理员失败")}else alert("请至少填写姓名、手机号和密码")}}},it=ot,nt=(0,l.A)(it,at,rt,!1,null,"744f0dd2",null),lt=nt.exports,ct=function(){var t=this,e=t._self._c;return e("div",{staticClass:"dept-panel"},[e("h2",[t._v("科室管理员工作台")]),e("p",{staticClass:"tip"},[t._v(" 本页面用于维护本科室医生的号源，并查看本科室所有医生的挂号记录，同时可以向医生和患者发送系统消息。 ")]),e("section",{staticClass:"block"},[e("h3",[t._v("本科室医生列表")]),e("div",{staticClass:"assign-bar"},[e("label",[t._v("加入已有医生到本科室：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.assignDoctorId,expression:"assignDoctorId"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入医生的 UserID，例如 DR0001"},domProps:{value:t.assignDoctorId},on:{input:function(e){e.target.composing||(t.assignDoctorId=e.target.value)}}}),e("button",{staticClass:"btn small",on:{click:t.assignDoctor}},[t._v("加入本科室")])]),t.doctors.length?e("table",{staticClass:"table"},[t._m(0),e("tbody",t._l(t.doctors,function(s){return e("tr",{key:s.userId},[e("td",[t._v(t._s(s.userId))]),e("td",[t._v(t._s(s.doctorName))]),e("td",[t._v(t._s(s.title))])])}),0)]):e("div",{staticClass:"empty-tip"},[t._v("当前科室暂无医生，请先创建或加入医生账号。")])]),e("section",{staticClass:"block"},[e("h3",[t._v("分配号源")]),e("div",{staticClass:"form-row"},[e("label",[t._v("医生：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.slotForm.doctorId,expression:"slotForm.doctorId"}],staticClass:"input",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.slotForm,"doctorId",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:""}},[t._v("请选择医生")]),t._l(t.doctors,function(s){return e("option",{key:s.userId,domProps:{value:s.userId}},[t._v(" "+t._s(s.doctorName)+"（"+t._s(s.userId)+"） ")])})],2)]),e("div",{staticClass:"form-row"},[e("label",[t._v("日期：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.slotForm.slotDate,expression:"slotForm.slotDate"}],staticClass:"input",attrs:{type:"date"},domProps:{value:t.slotForm.slotDate},on:{input:function(e){e.target.composing||t.$set(t.slotForm,"slotDate",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("开始时间：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.slotForm.startTime,expression:"slotForm.startTime"}],staticClass:"input",attrs:{type:"time"},domProps:{value:t.slotForm.startTime},on:{input:function(e){e.target.composing||t.$set(t.slotForm,"startTime",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("结束时间：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.slotForm.endTime,expression:"slotForm.endTime"}],staticClass:"input",attrs:{type:"time"},domProps:{value:t.slotForm.endTime},on:{input:function(e){e.target.composing||t.$set(t.slotForm,"endTime",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("号源数量：")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.slotForm.capacity,expression:"slotForm.capacity",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",min:"1"},domProps:{value:t.slotForm.capacity},on:{input:function(e){e.target.composing||t.$set(t.slotForm,"capacity",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("备注：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.slotForm.note,expression:"slotForm.note"}],staticClass:"input",attrs:{type:"text",placeholder:"可选，例如 上午门诊"},domProps:{value:t.slotForm.note},on:{input:function(e){e.target.composing||t.$set(t.slotForm,"note",e.target.value)}}})]),e("button",{staticClass:"btn",on:{click:t.createSlot}},[t._v("创建号源")]),e("h3",{staticStyle:{"margin-top":"24px"}},[t._v("号源列表")]),e("div",{staticClass:"form-row"},[e("label",[t._v("查看日期：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.slotQueryDate,expression:"slotQueryDate"}],staticClass:"input",attrs:{type:"date"},domProps:{value:t.slotQueryDate},on:{input:function(e){e.target.composing||(t.slotQueryDate=e.target.value)}}}),e("button",{staticClass:"btn small",on:{click:t.loadSlots}},[t._v("刷新")])]),t.slots.length?e("table",{staticClass:"table"},[t._m(1),e("tbody",t._l(t.slots,function(s){return e("tr",{key:s.slotId},[e("td",[t._v(t._s(s.doctorName)+"（"+t._s(s.doctorId)+"）")]),e("td",[t._v(t._s(s.slotDate))]),e("td",[t._v(t._s(t.formatSlotTime(s)))]),e("td",[t._v(t._s(s.capacity))]),e("td",[t._v(t._s(s.bookedCount))]),e("td",[t._v(t._s(s.status))]),e("td",[t._v(t._s(s.note))])])}),0)]):e("div",{staticClass:"empty-tip"},[t._v("当前日期暂无号源。")])]),e("section",{staticClass:"block"},[e("h3",[t._v("本科室挂号记录")]),e("div",{staticClass:"form-row"},[e("label",[t._v("日期：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.regQueryDate,expression:"regQueryDate"}],staticClass:"input",attrs:{type:"date"},domProps:{value:t.regQueryDate},on:{input:function(e){e.target.composing||(t.regQueryDate=e.target.value)}}}),e("button",{staticClass:"btn small",on:{click:t.loadRegistrations}},[t._v("刷新")])]),t.registrations.length?e("table",{staticClass:"table"},[t._m(2),e("tbody",t._l(t.registrations,function(s){return e("tr",{key:s.regId},[e("td",[t._v(t._s(s.regId))]),e("td",[t._v(t._s(s.patientId))]),e("td",[t._v(t._s(s.patientName))]),e("td",[t._v(t._s(s.doctorName)+"（"+t._s(s.doctorId)+"）")]),e("td",[t._v(t._s(s.regDate))]),e("td",[t._v(t._s(s.regTimeSlot))]),e("td",[t._v(t._s(s.regStatus))]),e("td",[t._v(t._s(s.payStatus))]),e("td",[e("button",{staticClass:"btn small",on:{click:function(e){return t.fillTarget(s.patientId)}}},[t._v("给患者")]),e("button",{staticClass:"btn small",staticStyle:{"margin-left":"6px"},on:{click:function(e){return t.fillTarget(s.doctorId)}}},[t._v("给医生")])])])}),0)]):e("div",{staticClass:"empty-tip"},[t._v("暂无挂号记录。")])]),e("section",{staticClass:"block"},[e("h3",[t._v("发送系统消息")]),e("div",{staticClass:"form-row"},[e("label",[t._v("目标用户ID：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.targetUserId,expression:"targetUserId"}],staticClass:"input",attrs:{type:"text",placeholder:"例如患者或医生的 UserID"},domProps:{value:t.targetUserId},on:{input:function(e){e.target.composing||(t.targetUserId=e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("标题：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"input",attrs:{type:"text"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("label",[t._v("内容：")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"textarea",attrs:{rows:"3"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),e("button",{staticClass:"btn",on:{click:t.sendMessage}},[t._v("发送消息")])])])},dt=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("医生ID")]),e("th",[t._v("姓名")]),e("th",[t._v("职称")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("医生")]),e("th",[t._v("日期")]),e("th",[t._v("时间段")]),e("th",[t._v("容量")]),e("th",[t._v("已预约")]),e("th",[t._v("状态")]),e("th",[t._v("备注")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("挂号号")]),e("th",[t._v("患者ID")]),e("th",[t._v("患者姓名")]),e("th",[t._v("医生")]),e("th",[t._v("日期")]),e("th",[t._v("时段")]),e("th",[t._v("状态")]),e("th",[t._v("支付状态")]),e("th",[t._v("发送消息")])])])}],mt={data(){return{doctors:[],assignDoctorId:"",slotForm:{doctorId:"",slotDate:"",startTime:"",endTime:"",capacity:1,note:""},slotQueryDate:"",slots:[],regQueryDate:"",registrations:[],targetUserId:"",title:"",content:""}},created(){const t=(new Date).toISOString().slice(0,10);this.slotQueryDate=t,this.regQueryDate=t,this.loadDoctors(),this.loadSlots(),this.loadRegistrations()},methods:{async loadDoctors(){try{const t=await h.get("/dept/doctors"),e=t.data;0===e.error_code?this.doctors=e.data||[]:this.doctors=[]}catch(t){console.error(t),this.doctors=[]}},async assignDoctor(){if(this.assignDoctorId)try{const t=await h.post(`/dept/doctors/${this.assignDoctorId}/assign`),e=t.data;alert(e.msg||"操作完成"),this.assignDoctorId="",this.loadDoctors()}catch(t){console.error(t),alert("操作失败，请稍后重试")}else alert("请先输入要加入的医生ID")},async createSlot(){const t=this.slotForm;if(t.doctorId&&t.slotDate&&t.startTime&&t.endTime&&t.capacity)try{const e=await h.post("/dept/slots",t),s=e.data;alert(s.msg||"创建成功"),this.loadSlots()}catch(e){console.error(e),alert("创建号源失败，请稍后重试")}else alert("请完整填写医生、日期、起止时间和号源数量")},async loadSlots(){try{const t=await h.get("/dept/slots",{params:{date:this.slotQueryDate||null}}),e=t.data;0===e.error_code?this.slots=e.data||[]:this.slots=[]}catch(t){console.error(t),this.slots=[]}},async loadRegistrations(){try{const t=await h.get("/dept/registrations",{params:{date:this.regQueryDate||null}}),e=t.data;0===e.error_code?this.registrations=e.data||[]:this.registrations=[]}catch(t){console.error(t),this.registrations=[]}},formatSlotTime(t){if(!t)return"";const e=t.startTime?String(t.startTime).substring(0,5):"",s=t.endTime?String(t.endTime).substring(0,5):"";return e&&s?`${e}-${s}`:""},fillTarget(t){this.targetUserId=t},async sendMessage(){if(this.targetUserId&&this.title&&this.content)try{const t=await h.post("/messages",{targetUserId:this.targetUserId,title:this.title,content:this.content}),e=t.data;0===e.error_code?(alert("发送成功"),this.title="",this.content=""):alert(e.msg||"发送失败")}catch(t){console.error(t),alert("发送请求失败，请稍后重试")}else alert("请填写目标用户、标题和内容")}}},ut=mt,pt=(0,l.A)(ut,ct,dt,!1,null,"d5d96406",null),vt=pt.exports;a.Ay.use(m.Ay);const gt=new m.Ay({routes:[{path:"/",redirect:()=>{const t=localStorage.getItem("userInfo");return t?"/profile":"/login-register"}},{path:"/login-register",name:"LoginRegister",component:I},{path:"/registration",name:"RegistrationPage",component:U,meta:{roles:["patient"]}},{path:"/message",name:"MessagePage",component:E},{path:"/profile",name:"ProfilePage",component:K},{path:"/doctor-panel",name:"DoctorPanel",component:st,meta:{roles:["doctor"]}},{path:"/admin-panel",name:"AdminPanel",component:lt,meta:{roles:["admin"]}},{path:"/dept-panel",name:"DeptPanel",component:vt,meta:{roles:["dept_manager"]}}]});gt.beforeEach((t,e,s)=>{const a=localStorage.getItem("userInfo"),r=a?JSON.parse(a):null,o=t.meta&&t.meta.roles,i="/login-register"===t.path;return r||i?r&&"/login-register"===t.path?s("/profile"):!o||!o.length||r&&o.includes(r.role)?void s():(alert("无权限访问该页面，请先使用对应账号登录"),s("/login-register")):s("/login-register")});var ht=gt;a.Ay.config.productionTip=!1,new a.Ay({router:ht,render:t=>t(d)}).$mount("#app")}},e={};function s(a){var r=e[a];if(void 0!==r)return r.exports;var o=e[a]={exports:{}};return t[a].call(o.exports,o,o.exports,s),o.exports}s.m=t,function(){var t=[];s.O=function(e,a,r,o){if(!a){var i=1/0;for(d=0;d<t.length;d++){a=t[d][0],r=t[d][1],o=t[d][2];for(var n=!0,l=0;l<a.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every(function(t){return s.O[t](a[l])})?a.splice(l--,1):(n=!1,o<i&&(i=o));if(n){t.splice(d--,1);var c=r();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,r,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var r,o,i=a[0],n=a[1],l=a[2],c=0;if(i.some(function(e){return 0!==t[e]})){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(l)var d=l(s)}for(e&&e(a);c<i.length;c++)o=i[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},a=self["webpackChunkmedical_regist"]=self["webpackChunkmedical_regist"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(6153)});a=s.O(a)})();
//# sourceMappingURL=app.834804f6.js.map